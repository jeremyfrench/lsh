2002-11-15  Niels Möller  <niels@s3.kth.se>

	* testsuite/Makefile.am (AM_LDFLAGS): Need -L../../nettle.
	(TS_PROGS): Added read-acl-test.

	* testsuite/read-acl-test.c: New test case.

	* testsuite/principal-test.c: Renamed file, was subject-test.c. 

	* certificate.c (hash_data): New function.
	(spki_principal_add_key): Made static. Use hash_data, and set the
	flags.
	(spki_principal_add_md5): New function.
	(spki_principal_add_sha1): New function.
	(spki_principal_by_key): Compare hashes. Create new principal if
	no old one matches.
	(spki_principal_by_md5): Check flag to see if md5 hash of each
	principal on the list is known.
	(spki_principal_by_sha1): Likewise, for sha1.
	(spki_check_type): Advance iterator past the matched type.
	(parse_principal): Handle hashes.
	(parse_tag): New function.
	(parse_acl_entry): Unlike certificates, subexpressions must come
	in order, and there's no <subject>-expression.
	(spki_acl_parse): Fixed version check.

	* certificate.h (struct spki_hashes): New struct.
	(enum spki_principal_flags): New enum.
	(struct spki_principal): Use flags to keep track of which hash
	values are known.
	(enum spki_5_tuple_flags): Renamed, was spki_flags.

	* spki-types.in: Added "comment" and "valid".

2002-11-14  Niels Möller  <niels@s3.kth.se>

	* spki-types.in: Added types public-key, md5 and sha1.

	* certificate.c (spki_principal_add_key): Deleted code for
	dynamic allocation of hash digests.
	(spki_principal_by_md5): New function.
	(spki_principal_by_sha1): New function.
	(parse_principal): Implemented handling of public key and hash
	expressions.

	* certificate.h (struct spki_principal): Store hashes directly in
	the struct, without pointers.

	* Makefile.am (bootstrap): New target.
	(spki-types.h, spki-type-names.h, spki-gperf.h): Create files in
	the source tree. 

2002-11-14  Niels Möller  <nisse@cuckoo.hack.org>

	* certificate.h (struct spki_5_tuple): Renamed (was spki_acl), and
	added issuer field.

2002-11-13  Niels Möller  <nisse@cuckoo.hack.org>

	* certificate.c: Include automatically generated files.
	(spki_intern): New function.
	(spki_get_type): New function.
	(spki_check_type): New function.
	(parse_principal): Placeholder for needed function.
	(parse_acl_entry): New function.
	(spki_acl_parse): Use parse_acl_entry.

	* Makefile.am: Added rules for process-types and related files.

	* spki-types.in: New file, containing listing spki's magic words.

	* process-types: New file, similar to lsh's process_atoms.

2002-11-13  Niels Möller  <niels@s3.kth.se>

	* certificate.c (spki_acl_parse): New function (not done yet).

	* certificate.h, certificate.c: Fixed terminology, refer to keys
	as "principals", not "subjects". 

	* Makefile.am (AM_CPPFLAGS): Use $(srcdir).
	* testsuite/Makefile.am (AM_CFLAGS): Use $(top_srcdir).

	* .bootstrap: Run autoheader before autoconf.

2002-11-13  Niels Möller  <nisse@cuckoo.hack.org>

	* testsuite/subject-test.c: First test case.

	* testsuite/run-tests: Copied from lsh:s testsuite.

	* certificate.c: Implemented basic handling of keys.

