2002-03-26  Pontus Sköld  <pont@soua.net>

	* buffer.c (sftp_read_packet): Cosmetic fixes and a bugfix (if
	sftp_get_data returns -1, it's not ok).

	* gnu_stuff.c (help_option): Added an help text. It needs work but
	is (hopefully) better than nothing.

2002-03-25  Pontus Sköld  <pont@soua.net>

	* buffer.c (sftp_read_packet): Loop to read data.
	(sftp_get_data): Likewise.
	(sftp_write_packet): Loop to write data.

	* sftp_c.c (sftp_ls_main): Check return values from
	sftp_get_string.

	* sftp-test-client.c (fork_server): Use fds, not FILE*s.

	* sftp-server.c (sftp_init): Use fds, not FILE*s.
	(main): Use fds STDIN_FILENO and STDOUT_FILENO instead of FILE*s
	stdin and stdout.

	* buffer.c: We need unistd.h to have read and write defined. And
	we want errno to, so we need errno.h
	(sftp_make_input): Use fd, not FILE*
	(sftp_make_output): Likewise.	

	* sftp_bind.c (lsftp_close_connection): Use fd_to_transport and
	fd_from_transport instead of to_transport and from_transport.

	* configure.ac (CPPFLAGS): use AC_DEFINE_UNQUOTED instead of
	putting options for before and after in CPPFLAGS. Solves problem
	with spaces in before- and after-opts.
 
	* sftp_bind.c (lsftp_open_connection): Dont't use FILE* but fds
	directly.
	(lsftp_handshake): Use read instead of fread, and pass fds to
	sftp_make_input and sftp_make_output.

	* buffer.c (struct sftp_input): Use fd instead of FILE*.
	(struct sftp_output): Likewise.
	(sftp_get_data): Use read instead of fread.
	(sftp_read_packet): Likewise.
	(sftp_write_packet): Use write instead of fwrite.

	* buffer.h: Changed prototype of sftp_make_input and
	sftp_make_output to use fds instead of files.

2002-03-24  Pontus Sköld  <pont@soua.net>

	* configure.ac: Added --no-pty to default options if we're using
	lsh(g).

	* commands.c (com_quit): Only call com_close if connected.

2002-03-23  Pontus Sköld  <pont@soua.net>

	* configure.ac: Removed -G from default after options.

2002-03-23  Pontus Sköld  <pont@it.uu.se>

	* configure.ac (termcap): Added check for libtermcap. This should
	help systems with a dynamically linked libreadline that depends on
	libtermcap.

2002-03-21  Pontus Sköld  <pont@soua.net>

	* configure.ac: Almost completely rewrote the checks for readline
	and history, now actually uses the results of the library checks.

	* rl.c: Use WITH_READLINE and WITH_HISTORY instead of header
	existence.
	
	* rl.h: Use <readline.h> and <history.h> if available.

2002-03-19  Pontus Sköld  <pont@it.uu.se>

	* Makefile.am: sftp-server should go to sbin (or should it go to
	libexec? Not bin anyway).

2002-03-18  Niels Möller  <nisse@lysator.liu.se>

	* commands.c (com_umask): Use unsigned char.
	(com_chown): Likewise.
	(com_chgrp): Likewise.
	(handle_command): Unsigned char argument.

2002-03-14  Pontus  <pont@it.uu.se>

	* configure.ac: Changed version number from 1.0 to 1.0-pre to make
	sure noone thinks "to highly" of the code. Also removed debug code
	that shouldn't have been checked in.

2002-02-27  Niels Möller  <nisse@cuckoo.hack.org>

	* gnu_stuff.c: Include stdlib.h and string.h.

2002-02-25  Pontus  <pont@it.uu.se>

	* lsftp.c (main): Readded support for GNU-thingies (was lost
	somehow some time ago).

	* gnu_stuff.c (lsftp_welcome): Included Niels in welcome message.
	(version_option): dito.
	(do_gnu_stuff): New function to check for GNU-thingies.
	
	* configure.ac: Added ugly fix to detect if we're part of the main
	lsh distribution. If we are, assume $bindir/lshg works
	satisfactionary.
	
	* sftp_bind.c (lsftp_install_lsftp_cb): Return a pointer to the
	callback instead.
	(lsftp_do_rm): Adopted for new use of lsftp_install_lsftp_cb.
	(lsftp_do_get): dito.
	(lsftp_do_ls): dito.
	(lsftp_do_chmod): dito.
	(lsftp_do_mv): dito.
	(lsftp_do_realpath): dito.
	(string_comparer): Changed type for arguments from char** to const
	void*.

	* sftp_bind.h: Changed return type of lsftp_install_lsftp_cb from
	int to struct lsftp_callback*.

	* sftp_bind.c (lsftp_lsftp_cb_init): Fixed a bug using the same
	memory both for sftp_cbs and lsftp_cbs, mumble!

2002-02-24  Pontus  <pont@it.uu.se>

	* sftp_bind.c (lsftp_remove_lsftp_cb): Use lsftp_nullcb to clean
	out callback.
	(lsftp_handle_packet): Changed variable i (used twice) to r.

	* sftp_bind.h: New function lsftp_nullcb.

	* sftp_bind.c (lsftp_compact_sftp_cbs): Fixed a bug that would
	loose callbacks before a hole if there were any more.
	(lsftp_compact_lsftp_cbs): Fixed the same bug for struct
	lsftp_callbacks.
	(lsftp_handle_packet): Clean out old state after callbacks, should
	hopefully make things more robust.

	(lsftp_nullcb): New function to clean a struct lsftp_callback.

	* dc.c (lsftp_dc_init): Check that malloc succeeded before using
	the memory (duh!).
	
	* sftp_bind.c: Removed obsolete default callback array sizes.

	* dc.c: Removed obsolete default dircache size.

	* lsftp.c (main): Always init the callbacks.

	* sftp_bind.c (lsftp_lsftp_cb_init): Also clear option flags.

	* lsftp.c (main): Added some comments.

	* sftp_bind.c (lsftp_do_put): Added some comments.

2002-02-22  Pontus  <pont@it.uu.se>

	* configure.ac (lsh_cv_c_attribute): Removed obsolete checks for
	behaviour of stat and lstat.

2002-02-12  Pontus  <pont@it.uu.se>

	* commands.c (com_mv): Didn't properly check for error in return value of
	lsftp_dc_r_isdir.

2002-02-11  Pontus  <pont@it.uu.se>

	* sftp-server.c (sftp_process_realpath): Added deugging message.
	(sftp_process): Added debugging message.
	(sftp_process_symlink): Added debugging message.

	* buffer.c (sftp_read_packet): If called with data left, flush
	(read and throw away) remaining data.

	* configure.ac: Created new configure.ac as a merge of the
	configure.in from lsftp and the sftp package.

	* Started new Changelog in sftp. 

